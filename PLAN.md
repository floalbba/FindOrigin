# План реализации FindOrigin

Поэтапный порядок действий по реализации Telegram-бота FindOrigin на основе спецификации PROJECT.md.

---

## Этап 1. Инициализация проекта

1.1. Создать Next.js-проект (App Router, TypeScript)

1.2. Настроить конфигурацию для деплоя на Vercel:
   - `vercel.json` (если нужны особые настройки)
   - переменные окружения (токен бота, API-ключи)

1.3. Добавить зависимости:
   - библиотека для работы с Telegram API
   - библиотеки для парсинга и извлечения данных
   - клиент для AI (OpenAI/другой провайдер)

---

## Этап 2. Webhook-обработчик Telegram

2.1. Создать API-маршрут `POST /api/webhook` (или `/api/telegram/webhook`)

2.2. Реализовать приём `update` от Telegram:
   - валидация запроса (опционально: проверка секретного токена)
   - извлечение `chat.id` и `text` из `update.message`
   - обработка ссылок на посты (если `text` — ссылка на t.me)

2.3. Быстро возвращать `200 OK`:
   - не выполнять тяжёлую обработку в теле запроса
   - использовать фоновую обработку (очередь, отдельный вызов) или `sendMessage` с «печатает…» и последующим ответом

2.4. Отправка ответа через Telegram API `sendMessage`:
   - использовать `BOT_TOKEN` из переменных окружения
   - формировать текст ответа на основе результатов поиска

---

## Этап 3. Извлечение и подготовка входных данных

3.1. Определить источник текста:
   - если ввод — текст → использовать как есть
   - если ввод — ссылка на Telegram-пост → извлечь текст поста (Telegram API или парсинг)

3.2. Реализовать извлечение текста из ссылок:
   - распознавание ссылок вида `t.me/...`, `telegram.me/...`
   - получение содержимого поста через Telegram Bot API (если доступно) или внешний парсер

3.3. Нормализация текста:
   - очистка от лишних пробелов, переносов
   - приведение к единому формату для дальнейшей обработки

---

## Этап 4. Выделение ключевых сущностей

4.1. Реализовать извлечение:
   - ключевых утверждений (факты, тезисы)
   - дат
   - чисел
   - имён (персоны, организации)
   - ссылок

4.2. Выбор подхода:
   - регулярные выражения для дат, чисел, ссылок
   - NLP/LLM для утверждений и имён (если нужна точность)
   - или единый вызов AI для структурированного извлечения

4.3. Формирование поискового запроса:
   - объединение сущностей в эффективный поисковый запрос
   - приоритизация наиболее значимых элементов

---

## Этап 5. Поиск возможных источников

5.1. Выбрать и подключить поисковый API:
   - Google Custom Search API
   - Bing Search API
   - SerpAPI или аналог
   - или комбинация источников

5.2. Реализовать поиск по категориям:
   - официальные сайты
   - новостные сайты
   - блоги
   - исследования (научные статьи, отчёты)

5.3. Собрать и отфильтровать результаты:
   - ограничение количества (например, топ-10–20 по каждой категории)
   - базовая фильтрация по доменам/типам источников

---

## Этап 6. AI-сравнение и ранжирование

6.1. Подключить AI-провайдера:
   - OpenAI API (GPT-4 и т.п.)
   - или альтернатива (Claude, локальная модель)

6.2. Реализовать семантическое сравнение:
   - сравнение смысла, а не буквального текста
   - вход: исходный текст + кандидаты (заголовки, сниппеты, при необходимости — содержимое)

6.3. Ранжирование и выбор:
   - оценка релевантности каждого кандидата
   - отбор 1–3 лучших источников
   - расчёт оценки уверенности (например, 0–100% или «высокая/средняя/низкая»)

---

## Этап 7. Формирование и отправка ответа

7.1. Форматирование ответа пользователю:
   - список из 1–3 ссылок
   - краткое описание каждого источника
   - оценка уверенности

7.2. Отправка через `sendMessage`:
   - учёт лимита длины сообщения Telegram (4096 символов)
   - разбиение на несколько сообщений при необходимости

7.3. Обработка ошибок:
   - сообщение пользователю при сбоях
   - логирование для отладки

---

## Этап 8. Тестирование и деплой

8.1. Локальное тестирование:
   - ngrok или аналог для тестирования webhook
   - проверка полного цикла: сообщение → ответ

8.2. Регистрация webhook в Telegram:
   - `setWebhook` с URL Vercel

8.3. Деплой на Vercel:
   - подключение репозитория
   - настройка переменных окружения
   - проверка работы в продакшене

---

## Этап 9. Доработки (опционально)

9.1. Обработка команд (`/start`, `/help`)

9.2. Rate limiting и защита от злоупотреблений

9.3. Кэширование результатов для повторяющихся запросов

9.4. Улучшение промптов и логики AI для повышения качества ответов
